<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: rails | Bob 學習筆記]]></title>
  <link href="http://blog.poyi.tw/blog/categories/rails/atom.xml" rel="self"/>
  <link href="http://blog.poyi.tw/"/>
  <updated>2015-06-29T23:51:20+08:00</updated>
  <id>http://blog.poyi.tw/</id>
  <author>
    <name><![CDATA[Bob (PoYi)]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[[Rails] AJAX render errors in json]]></title>
    <link href="http://blog.poyi.tw/blog/2015/06/12/rails-ajax-render-error-in-json/"/>
    <updated>2015-06-12T19:02:48+08:00</updated>
    <id>http://blog.poyi.tw/blog/2015/06/12/rails-ajax-render-error-in-json</id>
    <content type="html"><![CDATA[<pre><code class="javascript new.html.erb">$.ajax({
  url: URL,
  async:false,
  data:{
    amount: 100,
  },
  dataType:'json',
  method:'post',
  success:function(data){
    // do success things
  },
  error:function(xhr){
    var errors = $.parseJSON(xhr.responseText).errors
    alert(errors);
  }
);
</code></pre>

<pre><code class="ruby orders_controller.rb ">def create
  if amount &lt; 100
    render :json =&gt; { :errors =&gt; "金額不足" }, :status =&gt; 422
    return 
  end
end
</code></pre>

<p>當錯誤回傳時，使用422(Unprocessable Entity)來做error handling</p>

<p>Reference:</p>

<p><a href="http://travisjeffery.com/b/2012/04/rendering-errors-in-json-with-rails/">http://travisjeffery.com/b/2012/04/rendering-errors-in-json-with-rails/</a>
<a href="http://stackoverflow.com/questions/16133923/400-vs-422-response-to-post-of-data">http://stackoverflow.com/questions/16133923/400-vs-422-response-to-post-of-data</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[Ruby] 匯出批次csv檔]]></title>
    <link href="http://blog.poyi.tw/blog/2014/05/06/ruby-csv-file/"/>
    <updated>2014-05-06T21:14:00+08:00</updated>
    <id>http://blog.poyi.tw/blog/2014/05/06/ruby-csv-file</id>
    <content type="html"><![CDATA[<p>讀取或寫入csv在ruby都蠻方便的，只是編碼或格式要稍微注意一下</p>

<h2>匯出csv</h2>

<pre><code class="ruby">header = ['name','money','age']
body = ['ruby','1000','18']
</code></pre>

<pre><code class="ruby export_to_csv_string 匯出csv的string格式再利用send_data下載">  head = 'EF BB BF'.split(' ').map{|a|a.hex.chr}.join() # 加入BOM，解決excel中文亂碼


  csv_string = CSV.generate(csv = head) do |csv|
    csv &lt;&lt; header
    csv &lt;&lt; body
  end

  # &gt; csv_string.encoding 執行這句會發現預設編碼為ACSII
  csv_string.force_encoding('big5')
  # BOM也可以這樣加 csv_string = "\xEF\xBB\xBF#{csv_string}"  
  # 若不需要調整格式就直接下載
  send_data csv_string
</code></pre>

<pre><code class="ruby export_to_csv 直接匯出檔案"> require 'csv'
 CSV.open("export.csv","w") do |csv|
   csv &lt;&lt; header
   csv &lt;&lt; body
 end
</code></pre>

<h2>半形轉全形</h2>

<p>在某些情況會需要轉出全形字元，照理說不用才對，<del>可能是因為合作對方的系統太爛</del>
其實也不太確定怎解，我單純用硬幹的方式
<figure class='code'><figcaption><span>convert_to_wide_word 大小寫英文數字轉全形字元</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">convert_to_wide_word</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</span><span class='line'>  <span class="n">text</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/[a-v]/</span><span class="p">){</span><span class="o">|</span><span class="n">a</span><span class="o">|</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">ord</span> <span class="o">+</span> <span class="mi">41608</span><span class="p">)</span><span class="o">.</span><span class="n">chr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lsquo</span><span class="p">;</span><span class="n">big5</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="p">;)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lsquo</span><span class="p">;</span><span class="n">utf</span><span class="o">-</span><span class="mi">8</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="p">;)}</span>
</span><span class='line'>    <span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/[w-z]/</span><span class="p">){</span><span class="o">|</span><span class="n">a</span><span class="o">|</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">ord</span> <span class="o">+</span> <span class="mi">41673</span><span class="p">)</span><span class="o">.</span><span class="n">chr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lsquo</span><span class="p">;</span><span class="n">big5</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="p">;)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lsquo</span><span class="p">;</span><span class="n">utf</span><span class="o">-</span><span class="mi">8</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="p">;)}</span>
</span><span class='line'>    <span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/[A-Z]/</span><span class="p">){</span><span class="o">|</span><span class="n">a</span><span class="o">|</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">ord</span> <span class="o">+</span> <span class="mi">41614</span><span class="p">)</span><span class="o">.</span><span class="n">chr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lsquo</span><span class="p">;</span><span class="n">big5</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="p">;)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lsquo</span><span class="p">;</span><span class="n">utf</span><span class="o">-</span><span class="mi">8</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="p">;)}</span>
</span><span class='line'>    <span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/[0-9]/</span><span class="p">){</span><span class="o">|</span><span class="n">a</span><span class="o">|</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">ord</span> <span class="o">+</span> <span class="mi">41599</span><span class="p">)</span><span class="o">.</span><span class="n">chr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lsquo</span><span class="p">;</span><span class="n">big5</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="p">;)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lsquo</span><span class="p">;</span><span class="n">utf</span><span class="o">-</span><span class="mi">8</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="p">;)}</span>
</span><span class='line'><span class="k">end</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;convert_to_wide_word(&amp;ldquo;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&amp;rdquo;)</span>
</span><span class='line'><span class="sr"> =&gt; &amp;ldquo;０１２３４５６７８９ａｂｃｄｅｆｇｈｉｊｋｌｍｎｏｐｑｒｓｔｕｖｗｘｙｚＡＢＣＤＥＦＧＨＩＪＫＬ</span>
</span><span class='line'><span class="sr"> ＭＮＯＰＱＲＳＴＵＶＷＸＹＺ&amp;rdquo;</span>
</span></code></pre></td></tr></table></div></figure>
匯出匯入csv也可以試試FasterCSV這個gem</p>

<p>Reference:</p>

<p><a href="http://www.sitepoint.com/guide-ruby-csv-library-part/">http://www.sitepoint.com/guide-ruby-csv-library-part/</a></p>

<p><a href="http://blog.inheart.tw/2013/09/rubyraisl-csv-excel.html">http://blog.inheart.tw/2013/09/rubyraisl-csv-excel.html</a></p>

<p><a href="http://salayhin.wordpress.com/2014/05/10/export-csv-file-from-rails-console/">http://salayhin.wordpress.com/2014/05/10/export-csv-file-from-rails-console/</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[Mac] Ruby on Rails 基本環境建置]]></title>
    <link href="http://blog.poyi.tw/blog/2014/01/17/rails-mac-os-environment-build/"/>
    <updated>2014-01-17T12:47:00+08:00</updated>
    <id>http://blog.poyi.tw/blog/2014/01/17/rails-mac-os-environment-build</id>
    <content type="html"><![CDATA[<p>是說終於買了mac，省去開箱文趕緊把環境用好來繼續練習ROR!!
但使用上還是有一點不習慣，會覺得有些地方也蠻不人性化，但相對穩定就是了</p>

<h2>以下環境為OS X 10.9.1</h2>

<p>1.安裝xcode-select
Command line tool已經獨立出來，不需要安裝XCode了
<code>bash terminal
$ xcode-select --install
</code>
<img src="http://user-image.logdown.io/user/2740/blog/2734/post/176032/wrVy25UMQkeJEnuNKSEq_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202014-01-17%20%E4%B8%8B%E5%8D%889.07.40.png" alt="螢幕快照 2014-01-17 下午9.07.40.png" /></p>

<p>如果安裝失敗的話也可以到<a href="https://developer.apple.com/downloads/index.action?q=xcode">這裡</a>下載
<img src="http://user-image.logdown.io/user/2740/blog/2734/post/176032/umDZbcPSNWfhQ0VNDr7l_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202014-01-17%20%E4%B8%8B%E5%8D%8810.01.05.png" alt="螢幕快照 2014-01-17 下午10.01.05.png" /></p>

<p>2.安裝homebrew
<code>bash terminal
$ ruby -e "$(curl -fsSL https://raw.github.com/mxcl/homebrew/go/install)"
</code></p>

<p>3.安裝所需要的工具
<code>bash terminal
$ brew install git
</code></p>

<p>4.安裝RVM
<code>bash terminal
$ curl -L https://get.rvm.io | bash -s stable
</code>
5.透過RVM來安裝RUBY
<code>bash terminal
$ rvm install ruby
</code>
6.透過RVM來安裝RubyGems
<code>bash terminal
$ rvm rubygems current
</code>
7.安裝Rails
<code>bash terminal
$ gem install rails
</code></p>

<hr />

<p>XCode:官方提供的一個IDE，主要用來開發IOS APP，不過它也包含了一些開發其他語言所需的環境
Homebrew: OSX 套件管理工具
RVM (Ruby Version Manager):Ruby版本管理工具，便於切換不同版本</p>

<p>Reference:</p>

<p><a href="http://www.computersnyou.com/2025/2013/06/install-command-line-tools-in-osx-10-9-mavericks-how-to/">http://www.computersnyou.com/2025/2013/06/install-command-line-tools-in-osx-10-9-mavericks-how-to/</a>
<a href="http://www.slideshare.net/marsz330/ruby-on-rails-for-mac">http://www.slideshare.net/marsz330/ruby-on-rails-for-mac</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[Rails] Bootstrap for Rails]]></title>
    <link href="http://blog.poyi.tw/blog/2013/12/07/rails-bootstrap-for-rails/"/>
    <updated>2013-12-07T06:46:00+08:00</updated>
    <id>http://blog.poyi.tw/blog/2013/12/07/rails-bootstrap-for-rails</id>
    <content type="html"><![CDATA[<pre><code class="bash add to gemfile.rb and remember to bundle install">gem 'bootstrap-sass'
</code></pre>

<pre><code class="bash 新增一個app/assets/stylesheets/styles.css.scss並將bootstrap import">@import 'bootstrap'
</code></pre>

<pre><code class="bash app/assets/javascripts/application.js 加入bootstrap">//= require bootstrap
</code></pre>

<p>這樣就可以用了yaya</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[Rails] 打包Gem套件]]></title>
    <link href="http://blog.poyi.tw/blog/2013/12/02/rails-gem/"/>
    <updated>2013-12-02T12:27:00+08:00</updated>
    <id>http://blog.poyi.tw/blog/2013/12/02/rails-gem</id>
    <content type="html"><![CDATA[<p>當我們要安裝別人寫好的Library、API時，通常會
<code>ruby Gemfile
gem 'google-translate'
</code>
或是
<code>bash  Terminal
$ gem install google-translate
</code></p>

<h1>打包gem</h1>

<p>而當我們要打包自己的gem，自用或供他人使用，該怎麼做？
<code>bash 用bundle 生成gem結構
$ bundle gem bob_test_plugin
</code></p>

<pre><code class="bash 建立gem">gem build bob_test_plugin.gemspec
</code></pre>

<p>此時會生成 bob_test_plugin-0.0.1.gem</p>

<pre><code class="bash 安裝gem">$ sudo gem install bob_test_plugin-0.0.1.gem
</code></pre>

<pre><code class="bash 在rails c下測試gem">irb&gt;require 'bob_test_plugin'
=&gt; true
irb&gt;BobTestPlugin.name
=&gt; "BobTestPlugin"
</code></pre>

<h1>發佈在 RubyGems.org</h1>

<p><a href="http://rubygems.org/sign_up">申請RubyGems帳號</a></p>

<pre><code class="bash 發佈">$ gem push bob_test_plugin-0.0.1.gem
</code></pre>

<p>Reference:
<a href="http://blog.xdite.net/posts/2012/01/04/how-to-pack-a-gem">http://blog.xdite.net/posts/2012/01/04/how-to-pack-a-gem</a>
<a href="http://jex.logdown.com/posts/164687-ruby-build-his-own-gem-packages">http://jex.logdown.com/posts/164687-ruby-build-his-own-gem-packages</a></p>
]]></content>
  </entry>
  
</feed>
