<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: rails | Bob 學習筆記]]></title>
  <link href="http://blog.poyi.tw/blog/categories/rails/atom.xml" rel="self"/>
  <link href="http://blog.poyi.tw/"/>
  <updated>2015-04-28T20:35:00+08:00</updated>
  <id>http://blog.poyi.tw/</id>
  <author>
    <name><![CDATA[Bob (PoYi)]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[[ruby] 匯出批次csv檔]]></title>
    <link href="http://blog.poyi.tw/blog/2014/05/06/ruby-csv-file/"/>
    <updated>2014-05-06T21:14:00+08:00</updated>
    <id>http://blog.poyi.tw/blog/2014/05/06/ruby-csv-file</id>
    <content type="html"><![CDATA[<p>讀取或寫入csv在ruby都蠻方便的，只是編碼或格式要稍微注意一下</p>

<h2>匯出csv</h2>

<pre><code class="ruby">header = ['name','money','age']
body = ['ruby','1000','18']
</code></pre>

<pre><code class="ruby export_to_csv_string 匯出csv的string格式再利用send_data下載">  head = 'EF BB BF'.split(' ').map{|a|a.hex.chr}.join() # 加入BOM，解決excel中文亂碼


  csv_string = CSV.generate(csv = head) do |csv|
    csv &lt;&lt; header
    csv &lt;&lt; body
  end

  # &gt; csv_string.encoding 執行這句會發現預設編碼為ACSII
  csv_string.force_encoding('big5')
  # BOM也可以這樣加 csv_string = "\xEF\xBB\xBF#{csv_string}"  
  # 若不需要調整格式就直接下載
  send_data csv_string
</code></pre>

<pre><code class="ruby export_to_csv 直接匯出檔案"> require 'csv'
 CSV.open("export.csv","w") do |csv|
   csv &lt;&lt; header
   csv &lt;&lt; body
 end
</code></pre>

<h2>半形轉全形</h2>

<p>在某些情況會需要轉出全形字元，照理說不用才對，<del>可能是因為合作對方的系統太爛</del>
其實也不太確定怎解，我單純用硬幹的方式
<figure class='code'><figcaption><span>convert_to_wide_word 大小寫英文數字轉全形字元</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">convert_to_wide_word</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</span><span class='line'>  <span class="n">text</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/[a-v]/</span><span class="p">){</span><span class="o">|</span><span class="n">a</span><span class="o">|</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">ord</span> <span class="o">+</span> <span class="mi">41608</span><span class="p">)</span><span class="o">.</span><span class="n">chr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lsquo</span><span class="p">;</span><span class="n">big5</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="p">;)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lsquo</span><span class="p">;</span><span class="n">utf</span><span class="o">-</span><span class="mi">8</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="p">;)}</span>
</span><span class='line'>    <span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/[w-z]/</span><span class="p">){</span><span class="o">|</span><span class="n">a</span><span class="o">|</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">ord</span> <span class="o">+</span> <span class="mi">41673</span><span class="p">)</span><span class="o">.</span><span class="n">chr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lsquo</span><span class="p">;</span><span class="n">big5</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="p">;)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lsquo</span><span class="p">;</span><span class="n">utf</span><span class="o">-</span><span class="mi">8</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="p">;)}</span>
</span><span class='line'>    <span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/[A-Z]/</span><span class="p">){</span><span class="o">|</span><span class="n">a</span><span class="o">|</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">ord</span> <span class="o">+</span> <span class="mi">41614</span><span class="p">)</span><span class="o">.</span><span class="n">chr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lsquo</span><span class="p">;</span><span class="n">big5</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="p">;)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lsquo</span><span class="p">;</span><span class="n">utf</span><span class="o">-</span><span class="mi">8</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="p">;)}</span>
</span><span class='line'>    <span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/[0-9]/</span><span class="p">){</span><span class="o">|</span><span class="n">a</span><span class="o">|</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">ord</span> <span class="o">+</span> <span class="mi">41599</span><span class="p">)</span><span class="o">.</span><span class="n">chr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lsquo</span><span class="p">;</span><span class="n">big5</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="p">;)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lsquo</span><span class="p">;</span><span class="n">utf</span><span class="o">-</span><span class="mi">8</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="p">;)}</span>
</span><span class='line'><span class="k">end</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;convert_to_wide_word(&amp;ldquo;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&amp;rdquo;)</span>
</span><span class='line'><span class="sr"> =&gt; &amp;ldquo;０１２３４５６７８９ａｂｃｄｅｆｇｈｉｊｋｌｍｎｏｐｑｒｓｔｕｖｗｘｙｚＡＢＣＤＥＦＧＨＩＪＫＬ</span>
</span><span class='line'><span class="sr"> ＭＮＯＰＱＲＳＴＵＶＷＸＹＺ&amp;rdquo;</span>
</span></code></pre></td></tr></table></div></figure>
匯出匯入csv也可以試試FasterCSV這個gem</p>

<p>Reference:</p>

<p><a href="http://www.sitepoint.com/guide-ruby-csv-library-part/">http://www.sitepoint.com/guide-ruby-csv-library-part/</a></p>

<p><a href="http://blog.inheart.tw/2013/09/rubyraisl-csv-excel.html">http://blog.inheart.tw/2013/09/rubyraisl-csv-excel.html</a></p>

<p><a href="http://salayhin.wordpress.com/2014/05/10/export-csv-file-from-rails-console/">http://salayhin.wordpress.com/2014/05/10/export-csv-file-from-rails-console/</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[Rails] Bootstrap for Rails]]></title>
    <link href="http://blog.poyi.tw/blog/2013/12/07/rails-bootstrap-for-rails/"/>
    <updated>2013-12-07T06:46:00+08:00</updated>
    <id>http://blog.poyi.tw/blog/2013/12/07/rails-bootstrap-for-rails</id>
    <content type="html"><![CDATA[<pre><code class="bash add to gemfile.rb and remember to bundle install">gem 'bootstrap-sass'
</code></pre>

<pre><code class="bash 新增一個app/assets/stylesheets/styles.css.scss並將bootstrap import">@import 'bootstrap'
</code></pre>

<pre><code class="bash app/assets/javascripts/application.js 加入bootstrap">//= require bootstrap
</code></pre>

<p>這樣就可以用了yaya</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[Rails] 打包Gem套件]]></title>
    <link href="http://blog.poyi.tw/blog/2013/12/02/rails-gem/"/>
    <updated>2013-12-02T12:27:00+08:00</updated>
    <id>http://blog.poyi.tw/blog/2013/12/02/rails-gem</id>
    <content type="html"><![CDATA[<p>當我們要安裝別人寫好的Library、API時，通常會
<code>ruby Gemfile
gem 'google-translate'
</code>
或是
<code>bash  Terminal
$ gem install google-translate
</code></p>

<h1>打包gem</h1>

<p>而當我們要打包自己的gem，自用或供他人使用，該怎麼做？
<code>bash 用bundle 生成gem結構
$ bundle gem bob_test_plugin
</code></p>

<pre><code class="bash 建立gem">gem build bob_test_plugin.gemspec
</code></pre>

<p>此時會生成 bob_test_plugin-0.0.1.gem</p>

<pre><code class="bash 安裝gem">$ sudo gem install bob_test_plugin-0.0.1.gem
</code></pre>

<pre><code class="bash 在rails c下測試gem">irb&gt;require 'bob_test_plugin'
=&gt; true
irb&gt;BobTestPlugin.name
=&gt; "BobTestPlugin"
</code></pre>

<h1>發佈在 RubyGems.org</h1>

<p><a href="http://rubygems.org/sign_up">申請RubyGems帳號</a></p>

<pre><code class="bash 發佈">$ gem push bob_test_plugin-0.0.1.gem
</code></pre>

<p>Reference:
<a href="http://blog.xdite.net/posts/2012/01/04/how-to-pack-a-gem">http://blog.xdite.net/posts/2012/01/04/how-to-pack-a-gem</a>
<a href="http://jex.logdown.com/posts/164687-ruby-build-his-own-gem-packages">http://jex.logdown.com/posts/164687-ruby-build-his-own-gem-packages</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[Rails] Connect SQL Server]]></title>
    <link href="http://blog.poyi.tw/blog/2013/10/30/rails-search/"/>
    <updated>2013-10-30T16:29:00+08:00</updated>
    <id>http://blog.poyi.tw/blog/2013/10/30/rails-search</id>
    <content type="html"><![CDATA[<p>看到官方提供的adpter..真的不知道怎麼下手.. <del>魯蛇無誤</del></p>

<h2>Ubuntu Connect to SQL Server</h2>

<p>想在Unix、Linux環境上，存取SQL Server似乎大多都使用FreeTDS
<code>bash 安裝FreeTDS
$ sudo apt-get install freetds-dev freetds-bin tdsodbc
</code></p>

<pre><code class="bash 檢查FreeTDS版本資訊">$ tsql -C
</code></pre>

<p><img src="http://user-image.logdown.io/user/2740/blog/2734/post/156771/0fBGvXZHQ4ug2ZQOTol3_2013-11-6%20%E4%B8%8A%E5%8D%88%2010-53-15.jpg" alt="2013-11-6 上午 10-53-15.jpg" /></p>

<pre><code class="bash 這時候就可以Connect SQL Server">$ tsql -H (SQL Server IP) -p 1433 -U (account) －P (password) –D (datebase name)
</code></pre>

<pre><code class="bash 直接下TSQL，這邊要用go才會執行">$ select * from Team
$ go
</code></pre>

<p><img src="http://user-image.logdown.io/user/2740/blog/2734/post/156771/J9JDVHr7S9uu6H8nhWLj_2013-11-6%20%E4%B8%8A%E5%8D%88%2011-03-53.jpg" alt="2013-11-6 上午 11-03-53.jpg" /></p>

<p>這邊代表已能在Ubuntu Connect SQL Server
但Rails還需要其他套件</p>

<hr />

<h2>Rails Connect to SQL Server (Error)</h2>

<pre><code class="bash 安裝tiny_tds、sqlserver adapter">$ sudo gem install tiny_tds
$ sudo gem install activerecord-sqlserver-adapter
</code></pre>

<p>修改DateBase.yml
<img src="http://user-image.logdown.io/user/2740/blog/2734/post/156771/n2j3Og9gRCKcn9v70smh_2013-11-6%20%E4%B8%8A%E5%8D%88%2011-36-45.jpg" alt="2013-11-6 上午 11-36-45.jpg" /></p>

<p>OK..在這邊理論上是可以直接在Rails調用..
但執行時卻會出錯，查了一下好像還無解 (Rails 4似乎還不太支援之類的..)
錯誤訊息可參考 > <a href="https://github.com/rails-sqlserver/activerecord-sqlserver-adapter/issues/279">https://github.com/rails-sqlserver/activerecord-sqlserver-adapter/issues/279</a>
暫時找不到解法，除非把Rails降到3.x版</p>

<p>Reference:
<a href="https://github.com/rails-sqlserver">https://github.com/rails-sqlserver</a>
<a href="http://www.cnblogs.com/lwm-1988/archive/2012/05/28/2520728.html">http://www.cnblogs.com/lwm-1988/archive/2012/05/28/2520728.html</a>
<a href="http://stackoverflow.com/questions/12010780/rails-how-to-do-search">http://stackoverflow.com/questions/12010780/rails-how-to-do-search</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[Rails] CRUD 備忘]]></title>
    <link href="http://blog.poyi.tw/blog/2013/10/30/rails-crud/"/>
    <updated>2013-10-30T01:07:00+08:00</updated>
    <id>http://blog.poyi.tw/blog/2013/10/30/rails-crud</id>
    <content type="html"><![CDATA[<pre><code class="ruby index">&lt;%= link_to 'list', teams_path %&gt; # GET

def index
    @teams = Team.all
end
</code></pre>

<pre><code class="ruby show">&lt;%= link_to 'show', team_path(team) %&gt; # GET

def show
    @team = Team.find(params[:id])
end
</code></pre>

<pre><code class="ruby new">&lt;%= link_to 'new Team', new_team_path %&gt;

def new
    @team = Team.new
end
</code></pre>

<pre><code class="ruby create">&lt;%= form_for @team, :url =&gt; teams_path do |t| %&gt; #In a form, the default request method is POST
&lt;%= t.text_field :name %&gt;
&lt;%= t.text_field :year %&gt;
&lt;%= t.submit "Create" %&gt;
&lt;% end %&gt;

def create
    Team.create(params[:id])
end
</code></pre>

<pre><code class="ruby edit">&lt;%= link_to 'edit', edit_team_path(team) %&gt;

def edit
    @team = Team.find(params[:id])
end
</code></pre>

<pre><code class="ruby update">&lt;%= form_for @team, :url =&gt; teams_path(@team),:method =&gt; :put do |t| %&gt; 
&lt;%= t.text_field :name %&gt;
&lt;%= t.text_field :year %&gt;
&lt;%= t.submit "Create" %&gt;
&lt;% end %&gt;

def update
    @team.update_attributes(params[:team]) #...
end
</code></pre>

<pre><code class="ruby destroy">&lt;%= link_to @team, team_path(@team), :method =&gt; :delete %&gt;

def destroy
    Team.find(params[:id].destroy
end
</code></pre>
]]></content>
  </entry>
  
</feed>
